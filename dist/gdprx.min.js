/*!
 * Gdprx - Simple GDPR compliant cookie and policy consent v1.0.0
 * https://github.com/woptima/gdprx
 *
 * Copyright 2018, Alberto Miconi
 * Released under the MIT license
 */
var $=jQuery.noConflict();function _setCookie(e,i,o){var c,t="";o&&((c=new Date).setTime(c.getTime()+24*o*60*60*1e3),t="; expires="+c.toUTCString()),document.cookie=e+"="+(i||"")+t+"; path=/"}function _getCookie(e){for(var i=e+"=",o=document.cookie.split(";"),c=0;c<o.length;c++){for(var t=o[c];" "==t.charAt(0);)t=t.substring(1,t.length);if(0==t.indexOf(i))return t.substring(i.length,t.length)}return null}function GdprxGetCookie(){var e=_getCookie("gdprx");null!=e&&(window.gdprxValues=JSON.parse(atob(e)))}function Gdprx(e){var t=this;this.cookieName="gdprx",this.gdprxValues={accepted:!1,cookiesAccepted:[],cookiesDenied:[]},this.init=function(){t.watchers(),t.cookieGet(),t.generateMarkup(),t.appendModal(),t.gdprxValues.accepted||t.loadBar()},this.config={bar_text:"This site uses cookies, you can set you preferences through the settings panel",cookie_groups:[{title:"Required",cookies:["phpsession","gdprx"],required:!0,default:!0,info:"Used for a correct uer experience"}],policies:[{title:"Privacy policy",info:"Privacy policy",url:""}],labels:{panel_title:"Privacy preferences",cookies:"Cookies",used_cookies:"Used cookies",policies:"Policies",required:"Required",preferences:"Preferences",accept:"Accept",view:"View",save:"Save"},ajax:{enable:!1,url:"",parameters:{}}},$.extend(!0,t.config,e),this.createSwitch=function(e){if(e.required)return'<div class="required-label">'+t.config.labels.required+"</div>";var i=1==e.default&&-1==t.gdprxValues.cookiesDenied.indexOf(e.title)?"checked":"";return'<label class="gdprx-switch"><input type="checkbox" class="gdprx-cookie-check" data-group="'+e.title+'" name="cookies-'+e.title+'" '+i+'><span class="gdpr-slider round"></span><span class="gdpr-switch-indicator-on">ON</span><span class="gdpr-switch-indicator-off">OFF</span></label>'},this.createPoliciesNav=function(e){return 0<e.length?'<li data-content="cont-policies" class="active">'+t.config.labels.policies+"</li>":void 0},this.createPoliciesTab=function(e){if(0<e.length){var o='<div class="content-tab active" id="cont-policies"><div class="policies-title">'+t.config.labels.policies+"</div>";return e.forEach(function(e,i){o+='<div class="cookie-panel"><div class="head">'+e.title+'<div class="switch"><div class="required-label">'+t.config.labels.required+'</div></div></div><div class="body"><div>'+e.info+'</div><div class="buttons"><a href="'+e.url+'" target="_blank" class="btn view">'+t.config.labels.view+"</a></div></div></div>"}),o+="</div>"}},this.createPoliciesLinks=function(e){if(0<e.length){var o="";return e.forEach(function(e,i){o+='<li><a href="'+e.url+'" target="_blank">'+e.title+"</a></li>"}),o}},this.createCookieNav=function(e){var o="";return e.forEach(function(e,i){active=1==++i&&t.config.policies.length<=0?"active":"",o+='<li data-content="cont-'+i+'" class="content-tab '+active+'">'+e.title+"</li>"}),o},this.createCookieTabs=function(e){var o="";return e.forEach(function(e,i){active=1==++i&&t.config.policies.length<=0?"active":"",o+='<div class="content-tab '+active+'" id="cont-'+i+'"><div class="cookie-title">'+e.title+'</div><div class="cookie-subtitle">'+e.info+'</div><div class="cookie-panel"><div class="head">'+t.config.labels.used_cookies+'<div class="switch">'+t.createSwitch(e)+'</div></div><div class="body">'+e.cookies.join(", ")+"</div></div></div>"}),o},this.generateMarkup=function(){t.bar='<div id="gdprx-bar" class="gdprx"><div class="content">'+t.config.bar_text+'</div><div class="buttons"><button class="preferences">'+t.config.labels.preferences+'</button><button class="accept">'+t.config.labels.accept+"</button></div></div>",t.modal='<div id="gdprx-modal" class="gdprx"><div class="modal-content"><div class="title">'+t.config.labels.panel_title+'<div class="close">X</div></div><div class="cookies"><div class="navs"><ul class="cookies-nav">'+t.createPoliciesNav(t.config.policies)+'<li class="list-title">'+t.config.labels.cookies+'</li><ul class="cookie-list">'+t.createCookieNav(t.config.cookie_groups)+'</ul></ul><ul class="policies">'+t.createPoliciesLinks(t.config.policies)+'</ul></div><div class="content">'+t.createPoliciesTab(t.config.policies)+t.createCookieTabs(t.config.cookie_groups)+'<div class="buttons"><button class="btn save">'+t.config.labels.save+"</button></div>"},this.watchers=function(){$(document).on("click","#gdprx-bar button.accept",function(e){t.accept()}).on("click","#gdprx-bar button.preferences",function(e){t.openModal()}).on("click",".gdprx-modal-opener",function(e){t.openModal()}).on("click","#gdprx-modal .title .close",function(e){t.closeModal()}).on("click","#gdprx-modal .btn.save",function(e){t.savePreferences()}).on("click","#gdprx-modal .cookies-nav li[data-content]",function(e){var i=$(this),o=i.attr("data-content");$("#gdprx-modal .cookies-nav > li, #gdprx-modal .content-tab").removeClass("active"),i.addClass("active"),$("#"+o).addClass("active")})},this.appendModal=function(){$(t.modal).appendTo("body")},this.cookieSet=function(){window.gdprxValues=t.gdprxValues;var e=btoa(JSON.stringify(t.gdprxValues));_setCookie(t.cookieName,e,365)},this.cookieGet=function(){var e=_getCookie(t.cookieName);null!=e&&(t.gdprxValues=JSON.parse(atob(e))),window.gdprxValues=t.gdprxValues},this.loadBar=function(){var e=$(t.bar);e.appendTo("body"),setTimeout(function(){e.addClass("active")},300)},this.closeBar=function(){$("#gdprx-bar").removeClass("active")},this.accept=function(){t.savePreferences()},this.openModal=function(){var e=$("#gdprx-modal");e.hasClass("active")||(e.addClass("visible"),setTimeout(function(){e.addClass("active")},100))},this.closeModal=function(){var e;$("#gdprx-modal").length&&((e=$("#gdprx-modal")).removeClass("active"),setTimeout(function(){e.removeClass("visible")},500))},this.savePreferences=function(){t.gdprxValues.cookiesAccepted=[],t.gdprxValues.cookiesDenied=[],t.gdprxValues.accepted=!0,t.config.cookie_groups.forEach(function(e,i){e.required&&t.gdprxValues.cookiesAccepted.push(e.title)}),$("input.gdprx-cookie-check").each(function(e,i){var o=$(this),c=o.attr("data-group");o.is(":checked")?t.gdprxValues.cookiesAccepted.push(c):t.gdprxValues.cookiesDenied.push(c)}),t.config.ajax.enable&&t.ajax(),t.cookieSet(),t.closeModal(),t.closeBar(),$(document).trigger("gdprxAccepted")},this.ajax=function(){var e=t.config.ajax.parameters;e.gdpr=t.gdprxValues,$.post(t.config.ajax.url,e)},this.init()}"object"==typeof exports&&(module.exports.gdprx=Gdprx);