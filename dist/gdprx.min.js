class Gdprx{constructor(e){this.cookieName="gdprx",this.gdprxValues={accepted:!1,cookiesAccepted:[],cookiesDenied:[]},this.config={bar_text:"This site uses cookies, you can set you preferences through the settings panel",cookie_groups:[{title:"Required",cookies:["phpsession","gdprx"],required:!0,default:!0,info:"Used for a correct uer experience"}],policies:[{title:"Privacy policy",info:"Privacy policy",url:""}],labels:{panel_title:"Privacy preferences",cookies:"Cookies",used_cookies:"Used cookies",policies:"Policies",required:"Required",preferences:"Preferences",accept:"Accept",view:"View",save:"Save"},ajax:{enable:!1,url:"",parameters:{}}},this.config=Object.assign({},this.config,e),this.watchers(),this.cookieGet(),this.generateMarkup(),this.appendModal(),this.gdprxValues.accepted||this.loadBar()}_setCookie(e,t,i){let s="";if(i){let e=new Date;e.setTime(e.getTime()+24*i*60*60*1e3),s="; expires="+e.toUTCString()}document.cookie=e+"="+(t||"")+s+"; path=/"}_getCookie(e){let t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let s=i[e];for(;" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null}createWindowCookieMethod(){window.GdprxGetCookie=(()=>{let e=this._getCookie("gdprx");null!=e&&(window.gdprxValues=JSON.parse(atob(e)))})}createSwitch(e){if(e.required)return'<div class="required-label">'+this.config.labels.required+"</div>";{let t=1==e.default&&-1==this.gdprxValues.cookiesDenied.indexOf(e.title)?"checked":"";return'<label class="gdprx-switch"><input type="checkbox" class="gdprx-cookie-check" data-group="'+e.title+'" name="cookies-'+e.title+'" '+t+'><span class="gdpr-slider round"></span><span class="gdpr-switch-indicator-on">ON</span><span class="gdpr-switch-indicator-off">OFF</span></label>'}}createPoliciesNav(e){return e.length>0?'<li data-content="cont-policies" class="active">'+this.config.labels.policies+"</li>":void 0}createPoliciesTab(e){if(e.length>0){let t='<div class="content-tab active" id="cont-policies"><div class="policies-title">'+this.config.labels.policies+"</div>";return e.forEach((e,i)=>{t+='<div class="cookie-panel"><div class="head">'+e.title+'<div class="switch"><div class="required-label">'+this.config.labels.required+'</div></div></div><div class="body"><div>'+e.info+'</div><div class="buttons"><a href="'+e.url+'" target="_blank" class="btn view">'+this.config.labels.view+"</a></div></div></div>"}),t+="</div>"}}createPoliciesLinks(e){if(e.length>0){let t="";return e.forEach((e,i)=>{t+='<li><a href="'+e.url+'" target="_blank">'+e.title+"</a></li>"}),t}}createCookieNav(e){let t="";return e.forEach((e,i)=>{let s=1==++i&&this.config.policies.length<=0?"active":"";t+='<li data-content="cont-'+i+'" class="content-tab '+s+'">'+e.title+"</li>"}),t}createCookieTabs(e){let t="";return e.forEach((e,i)=>{let s=1==++i&&this.config.policies.length<=0?"active":"";t+='<div class="content-tab '+s+'" id="cont-'+i+'"><div class="cookie-title">'+e.title+'</div><div class="cookie-subtitle">'+e.info+'</div><div class="cookie-panel"><div class="head">'+this.config.labels.used_cookies+'<div class="switch">'+this.createSwitch(e)+'</div></div><div class="body">'+e.cookies.join(", ")+"</div></div></div>"}),t}generateMarkup(){this.bar='<div id="gdprx-bar" class="gdprx"><div class="content">'+this.config.bar_text+'</div><div class="buttons"><button class="preferences">'+this.config.labels.preferences+'</button><button class="accept">'+this.config.labels.accept+"</button></div></div>",this.modal='<div id="gdprx-modal" class="gdprx"><div class="main-content"><div class="content-inner"><div class="title">'+this.config.labels.panel_title+'<div class="close">X</div></div><div class="cookies"><div class="navs"><ul class="cookies-nav">'+this.createPoliciesNav(this.config.policies)+'<li class="list-title">'+this.config.labels.cookies+'</li><ul class="cookie-list">'+this.createCookieNav(this.config.cookie_groups)+'</ul></ul><ul class="policies">'+this.createPoliciesLinks(this.config.policies)+'</ul></div><div class="content">'+this.createPoliciesTab(this.config.policies)+this.createCookieTabs(this.config.cookie_groups)+'<div class="buttons"><button class="btn save">'+this.config.labels.save+"</button></div>"}watchers(){document.addEventListener("click",e=>{const t=e.target;switch(!0){case t.matches("#gdprx-bar button.accept"):e.preventDefault(),this.accept();break;case t.matches("#gdprx-bar button.preferences"):case t.matches(".gdprx-modal-opener"):e.preventDefault(),this.openModal();break;case t.matches("#gdprx-modal .title .close"):e.preventDefault(),this.closeModal();break;case t.matches("#gdprx-modal .btn.save"):e.preventDefault(),this.savePreferences();break;case t.matches("#gdprx-modal .cookies-nav li[data-content]"):e.preventDefault();let i=t.getAttribute("data-content");document.querySelector("#gdprx-modal .cookies-nav > li, #gdprx-modal .content-tab").classList.remove("active"),t.classList.add("active"),document.querySelector("#"+i).classList.add("active")}})}cookieSet(){window.gdprxValues=this.gdprxValues;let e=btoa(JSON.stringify(this.gdprxValues));this._setCookie(this.cookieName,e,365)}cookieGet(){let e=this._getCookie(this.cookieName);null!=e&&(this.gdprxValues=JSON.parse(atob(e))),window.gdprxValues=this.gdprxValues}appendModal(){document.body.insertAdjacentHTML("beforeend",this.modal)}loadBar(){document.body.insertAdjacentHTML("beforeend",this.bar),setTimeout(()=>{document.getElementById("gdprx-bar").classList.add("active")},300)}closeBar(){let e=document.getElementById("gdprx-bar");e&&e.classList.contains("active")&&e.classList.remove("active")}accept(){this.savePreferences()}openModal(){let e=document.getElementById("gdprx-modal");e&&!e.classList.contains("active")&&(e.classList.add("visible"),setTimeout(()=>{e.classList.add("active")},100))}closeModal(){let e=document.getElementById("gdprx-modal");e&&(e.classList.remove("active"),setTimeout(()=>{e.classList.remove("visible")},500))}savePreferences(){this.gdprxValues.cookiesAccepted=[],this.gdprxValues.cookiesDenied=[],this.gdprxValues.accepted=!0,this.config.cookie_groups.forEach((e,t)=>{e.required&&this.gdprxValues.cookiesAccepted.push(e.title)}),document.querySelectorAll("input.gdprx-cookie-check").forEach((e,t)=>{let i=e.getAttribute("data-group");e.checked?this.gdprxValues.cookiesAccepted.push(i):this.gdprxValues.cookiesDenied.push(i)}),this.config.ajax.enable&&this.ajax(),this.cookieSet(),this.closeModal(),this.closeBar();const e=new Event("gdprxAccepted");document.dispatchEvent(e)}ajax(){let e=Object.assign({},this.config.ajax.parameters);e.gdpr=this.gdprxValues,fetch(this.config.ajax.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})}}